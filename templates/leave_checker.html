<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leave Checker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3b82f6;
      --primary-light: #60a5fa;
      --primary-dark: #2563eb;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --bg-light: #f9fafb;
      --bg-white: #ffffff;
      --text-primary: #111827;
      --text-secondary: #4b5563;
      --border-color: #e5e7eb;
      --shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
      --radius: 0.5rem;
      --transition: all 0.2s ease;
      --max-width: 800px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-light);
      min-height: 100vh;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
    }

    /* App Header and Navigation */
    .app-header {
      background-color: var(--primary);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .app-logo {
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: 18px;
    }

    .app-logo svg {
      margin-right: 8px;
    }

    .nav-buttons {
      display: flex;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius);
      margin-left: 1rem;
    }

    .nav-button {
      background-color: transparent;
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.5rem;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .nav-button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* Tab Navigation */
    .tab-navigation {
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .tab-nav {
      display: flex;
      overflow-x: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
      border-bottom: none;
      margin-bottom: 0;
    }

    .tab-nav::-webkit-scrollbar {
      display: none;
    }

    .tab-item {
      padding: 1rem 1.5rem;
      white-space: nowrap;
      color: var(--gray-600);
      font-weight: 500;
      position: relative;
      text-decoration: none;
      transition: color var(--transition-fast);
      margin-right: 0;
      user-select: none;
      cursor: pointer;
    }

    .tab-item:hover {
      color: var(--primary);
    }

    .tab-item.active {
      color: var(--primary);
    }

    .tab-item.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background-color: var(--primary);
      transform-origin: bottom;
      animation: slideIn 0.3s ease forwards;
    }

    @keyframes slideIn {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    /* Main Content Styles */
    .main-content {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 2rem;
      width: 100%;
    }

    .content-wrapper {
      width: 100%;
      max-width: var(--max-width);
      margin: 0 auto;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      color: var(--primary);
      text-decoration: none;
      margin-bottom: 1.5rem;
      font-weight: 500;
      transition: var(--transition);
    }

    .back-btn:hover {
      color: var(--primary-light);
    }

    .back-btn i {
      margin-right: 0.5rem;
    }

    .card {
      background-color: var(--bg-white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      margin-bottom: 1.5rem;
    }

    .title {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      color: var(--primary);
      margin-bottom: 2rem;
    }

    .subtitle {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
    }

    input, select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      font-size: 1rem;
      font-family: inherit;
      transition: var(--transition);
      background-color: var(--bg-white);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .btn {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
    }

    .btn:hover {
      background-color: var(--primary-dark);
    }

    .btn-secondary {
      background-color: #6b7280;
    }

    .btn-secondary:hover {
      background-color: #4b5563;
    }

    /* Tab Styles */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 2rem;
    }

    .tab {
      padding: 1rem 2rem;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      color: var(--text-secondary);
      position: relative;
      background-color: transparent;
      border: none;
      outline: none;
      user-select: none;
    }

    .tab:hover {
      color: var(--primary);
      background-color: rgba(59, 130, 246, 0.05);
    }

    .tab.active {
      color: var(--primary);
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--primary);
    }

    /* Form Visibility */
    .form {
      display: none;
      max-width: 500px;
      margin: 0 auto;
    }

    .form.active {
      display: block;
    }

    /* Messages */
    .error-message {
      color: var(--error);
      margin-top: 0.75rem;
      font-size: 0.875rem;
      padding: 0.5rem;
      background-color: #fee2e2;
      border-radius: var(--radius);
    }

    .success-message {
      color: var(--success);
      margin-top: 0.75rem;
      font-size: 0.875rem;
      padding: 0.5rem;
      background-color: #dcfce7;
      border-radius: var(--radius);
    }

    /* Loading State */
    .loading {
      display: none;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      margin: 1.5rem 0;
      color: var(--text-secondary);
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Results */
    .results {
      white-space: pre-wrap;
      line-height: 1.6;
      background-color: #f8fafc;
      padding: 1.5rem;
      border-radius: var(--radius);
      margin-top: 1.5rem;
      font-family: monospace;
    }

    /* Utility Classes */
    .hidden {
      display: none !important;
    }

    /* Electron-specific styles */
    .electron-only {
      display: none;
    }

    body.electron .electron-only {
      display: flex;
    }

    .electron-app .electron-only {
      display: flex;
    }

    .electron-app .back-btn {
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-content {
        padding: 1rem;
      }

      .card {
        padding: 1.5rem;
      }

      .title {
        font-size: 1.75rem;
      }

      .tab {
        padding: 0.75rem 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- App Header with Navigation -->
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-logo">
        <svg width="24" height="24" viewBox="0 0 24 24">
          <path d="M12 2L2 7l10 5 10-5z" fill="var(--primary)"/>
          <path d="M2 17l10 5 10-5" fill="var(--primary)" fill-opacity="0.6"/>
          <path d="M2 12l10 5 10-5" fill="var(--primary)" fill-opacity="0.8"/>
        </svg>
        <span>AI Agent Pro</span>
      </div>
      <div class="nav-buttons electron-only">
        <button id="nav-back" class="nav-button" data-action="back" title="Back">
          <i class="ri-arrow-left-line"></i>
        </button>
        <button id="nav-forward" class="nav-button" data-action="forward" title="Forward">
          <i class="ri-arrow-right-line"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Tab Navigation Bar -->
  <nav class="tab-navigation">
    <div class="container">
      <div class="tab-nav">
        <a href="/email" class="tab-item">Email Summarizer</a>
        <a href="/document" class="tab-item">Document Summary</a>
        <a href="/object" class="tab-item">Object Detection</a>
        <a href="/leave" class="tab-item active">Leave Checker</a>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="content-wrapper">
      <a href="/" class="back-btn"><i class="ri-arrow-left-line"></i>Back to Agents</a>
      
      <div class="card">
        <h1 class="title">Leave Checker</h1>
        
        <!-- Auth Section -->
        <div id="auth-section">
          <div class="tabs">
            <button class="tab active" data-tab="login" id="login-tab">Login</button>
            <button class="tab" data-tab="signup" id="signup-tab">Sign Up</button>
          </div>
          
          <!-- Login Form -->
          <form id="login-form" class="form active">
            <div class="form-group">
              <label for="login-email">Email</label>
              <input type="email" id="login-email" required placeholder="you@example.com">
            </div>
            <div class="form-group">
              <label for="login-password">Password</label>
              <input type="password" id="login-password" required placeholder="Your password">
            </div>
            <button type="submit" class="btn">Login</button>
            <div id="login-error" class="error-message"></div>
          </form>
          
          <!-- Signup Form -->
          <form id="signup-form" class="form">
            <div class="form-group">
              <label for="signup-title">Title</label>
              <select id="signup-title" required>
                <option value="">Select your title</option>
                <option value="Mr.">Mr.</option>
                <option value="Mrs.">Mrs.</option>
                <option value="Ms.">Ms.</option>
              </select>
            </div>
            <div class="form-group">
              <label for="signup-name">Full Name</label>
              <input type="text" id="signup-name" required placeholder="Your full name">
            </div>
            <div class="form-group">
              <label for="signup-email">Email</label>
              <input type="email" id="signup-email" required placeholder="you@example.com">
            </div>
            <div class="form-group">
              <label for="signup-password">Password</label>
              <input type="password" id="signup-password" required placeholder="Choose a password">
            </div>
            <button type="submit" class="btn">Sign Up</button>
            <div id="signup-error" class="error-message"></div>
            <div id="signup-success" class="success-message"></div>
          </form>
        </div>
        
        <!-- Leave Checker Section -->
        <div id="leave-checker-section" class="hidden">
          <h2 class="subtitle">Check Your Leave Balance</h2>
          <form id="leave-check-form">
            <div class="form-group">
              <label for="month-input">Sheet Name</label>
              <input type="text" id="month-input" required placeholder="Enter sheet name (e.g. June 2020, July 2023)">
            </div>
            <button type="submit" class="btn">Fetch Leave Details</button>
          </form>
          
          <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <span>Loading your leave details...</span>
          </div>
          
          <div id="leave-results" class="results"></div>
          <div id="leave-error" class="error-message"></div>
          
          <button id="logout-btn" class="btn btn-secondary">
            Logout
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded event fired');
      
      // Debug function to log to console with timestamps
      function debugLog(message) {
        const now = new Date();
        const timestamp = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}.${now.getMilliseconds()}`;
        console.log(`[${timestamp}] ${message}`);
      }
      
      debugLog('DOM content loaded, setting up event listeners');
      
      // Set up back and forward navigation buttons
      const backButton = document.querySelector('.nav-button[data-action="back"]');
      const forwardButton = document.querySelector('.nav-button[data-action="forward"]');

      if (backButton) {
        debugLog('Back button found, adding event listener');
        backButton.addEventListener('click', function() {
          debugLog('Back button clicked');
          if (typeof navigateInApp === 'function') {
            navigateInApp('back');
          } else {
            console.error('navigateInApp function not available');
          }
        });
      } else {
        console.warn('Back button not found');
      }

      if (forwardButton) {
        debugLog('Forward button found, adding event listener');
        forwardButton.addEventListener('click', function() {
          debugLog('Forward button clicked');
          if (typeof navigateInApp === 'function') {
            navigateInApp('forward');
          } else {
            console.error('navigateInApp function not available');
          }
        });
      } else {
        console.warn('Forward button not found');
      }

      // Set active tab based on current URL
      const tabItems = document.querySelectorAll('.tab-item');
      const currentPath = window.location.pathname;
      
      debugLog(`Current path: ${currentPath}, found ${tabItems.length} tab items`);
      
      tabItems.forEach(item => {
        const href = item.getAttribute('href');
        debugLog(`Tab item href: ${href}`);
        
        if (href && currentPath.endsWith(href)) {
          item.classList.add('active');
          debugLog(`Set ${href} tab as active`);
        } else if (currentPath === '/' && href === '/') {
          item.classList.add('active');
          debugLog('Set home tab as active');
        }
        
        // Add click event to tabs that use data-target instead of href
        if (item.hasAttribute('data-target')) {
          debugLog(`Adding click event for tab with data-target: ${item.getAttribute('data-target')}`);
          item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('data-target');
            debugLog(`Tab clicked with target: ${targetId}`);
            
            // Remove active class from all tabs
            tabItems.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.style.display = 'none');
            
            // Show selected tab content
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
              targetContent.style.display = 'block';
              debugLog(`Displayed tab content: ${targetId}`);
            } else {
              debugLog(`Tab content with id ${targetId} not found`);
            }
          });
        }
      });

      // Set up login/signup tab switching
      const authTabs = document.querySelectorAll('.tab');
      debugLog(`Found ${authTabs.length} auth tabs`);
      
      authTabs.forEach(tab => {
        debugLog(`Adding click event for auth tab: ${tab.getAttribute('data-tab')}`);
        tab.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          debugLog(`Auth tab clicked: ${tabName}`);
          
          // Remove active class from all tabs
          authTabs.forEach(t => t.classList.remove('active'));
          
          // Add active class to clicked tab
          this.classList.add('active');
          
          // Hide all forms
          document.querySelectorAll('.form').forEach(form => {
            form.classList.remove('active');
          });
          
          // Show the selected form
          const selectedForm = document.getElementById(tabName + '-form');
          if (selectedForm) {
            selectedForm.classList.add('active');
            debugLog(`Displayed form: ${tabName}-form`);
          } else {
            debugLog(`Form with id ${tabName}-form not found`);
          }
        });
      });

      // Electron-specific initialization
      if (window.electronAPI) {
        debugLog('Electron API detected, initializing');
        window.electronAPI.send('logToMain', 'Leave Checker page initialized');
      } else {
        debugLog('Electron API not found');
      }
      
      // Authentication check
      checkAuthStatus();

      // Initialize form validators
      initializeValidators();
    });

    // DOM Elements
    const authSection = document.getElementById('auth-section');
    const leaveCheckerSection = document.getElementById('leave-checker-section');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const leaveCheckForm = document.getElementById('leave-check-form');
    const loginError = document.getElementById('login-error');
    const signupError = document.getElementById('signup-error');
    const signupSuccess = document.getElementById('signup-success');
    const leaveError = document.getElementById('leave-error');
    const leaveResults = document.getElementById('leave-results');
    const loading = document.getElementById('loading');
    const logoutBtn = document.getElementById('logout-btn');
    const tabs = document.querySelectorAll('.tab');
    const forms = document.querySelectorAll('.form');
    
    // Check if user is logged in
    function checkAuthStatus() {
      const userData = localStorage.getItem('leaveCheckerUser');
      if (userData) {
        // User is logged in
        authSection.classList.add('hidden');
        leaveCheckerSection.classList.remove('hidden');
      } else {
        // User is not logged in
        authSection.classList.remove('hidden');
        leaveCheckerSection.classList.add('hidden');
      }
    }

    // Login form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      console.log('Login form submitted');
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      loginError.textContent = '';
      
      try {
        console.log('Sending login request to /api/leave/login');
        const response = await fetch('/api/leave/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password }),
        });
        
        console.log('Login response received:', response.status);
        const data = await response.json();
        console.log('Login data:', data);
        
        if (data.success) {
          // Store user data in localStorage
          localStorage.setItem('leaveCheckerUser', JSON.stringify({
            id: data.data.id,
            email: data.data.email,
            fullName: data.data.full_name
          }));
          
          // Switch to leave checker section
          checkAuthStatus();
        } else {
          loginError.textContent = data.error || 'Login failed. Please try again.';
        }
      } catch (error) {
        console.error('Login fetch error:', error);
        loginError.textContent = 'An error occurred. Please try again.';
      }
    });

    // Signup form submission
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      console.log('Signup form submitted');
      
      const title = document.getElementById('signup-title').value;
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      signupError.textContent = '';
      signupSuccess.textContent = '';
      
      if (!title || !name || !email || !password) {
        signupError.textContent = 'All fields are required';
        return;
      }
      
      try {
        console.log('Sending signup request to /api/leave/signup');
        const response = await fetch('/api/leave/signup', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ title, name, email, password }),
        });
        
        console.log('Signup response received:', response.status);
        const data = await response.json();
        console.log('Signup data:', data);
        
        if (data.success) {
          signupSuccess.textContent = 'Registration successful! You can now log in.';
          signupForm.reset();
          
          // Switch to login tab after successful signup
          setTimeout(() => {
            tabs[0].click();
          }, 1500);
        } else {
          signupError.textContent = data.error || 'Registration failed. Please try again.';
        }
      } catch (error) {
        console.error('Signup fetch error:', error);
        signupError.textContent = 'An error occurred. Please try again.';
      }
    });

    // Leave check form submission
    leaveCheckForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      console.log('Leave check form submitted');
      
      const month = document.getElementById('month-input').value;
      
      // Get user data from localStorage
      const userData = JSON.parse(localStorage.getItem('leaveCheckerUser'));
      console.log('User data for leave check:', userData);
      
      if (!userData || !userData.fullName) {
        leaveError.textContent = 'User information not found. Please log in again.';
        return;
      }
      
      leaveError.textContent = '';
      leaveResults.textContent = '';
      loading.style.display = 'flex';
      
      try {
        console.log('Sending leave check request to /api/leave/check');
        const response = await fetch('/api/leave/check', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ month, employeeName: userData.fullName }),
        });
        
        console.log('Leave check response received:', response.status);
        const data = await response.json();
        console.log('Leave check data:', data);
        
        loading.style.display = 'none';
        
        if (data.success) {
          leaveResults.innerHTML = data.formattedData;
        } else {
          leaveError.textContent = data.error || 'Failed to fetch leave data. Please try again.';
        }
      } catch (error) {
        console.error('Leave check fetch error:', error);
        loading.style.display = 'none';
        leaveError.textContent = 'An error occurred. Please try again.';
      }
    });

    // Logout button
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('leaveCheckerUser');
      checkAuthStatus();
    });
    
    // Form validation
    function initializeValidators() {
      // Validate login form
      const loginEmailInput = document.getElementById('login-email');
      const loginPasswordInput = document.getElementById('login-password');
      
      // Validate signup form
      const signupTitleInput = document.getElementById('signup-title');
      const signupNameInput = document.getElementById('signup-name');
      const signupEmailInput = document.getElementById('signup-email');
      const signupPasswordInput = document.getElementById('signup-password');
      
      // Add validation classes on blur
      [loginEmailInput, loginPasswordInput, signupTitleInput, signupNameInput, signupEmailInput, signupPasswordInput].forEach(input => {
        input.addEventListener('blur', function() {
          if (!this.value.trim()) {
            this.classList.add('invalid');
          } else {
            this.classList.remove('invalid');
          }
        });
      });
    }
  </script>

  <!-- Include the Electron bridge script -->
  <script src="{{ url_for('static', filename='electron_bridge.js') }}"></script>

  <!-- Debug Script -->
  <script>
    console.log('Debug script loaded for leave checker');
    
    // Manually add click handlers to tabs for redundancy
    document.getElementById('login-tab').onclick = function() {
      console.log('Login tab clicked directly');
      document.getElementById('login-tab').classList.add('active');
      document.getElementById('signup-tab').classList.remove('active');
      document.getElementById('login-form').classList.add('active');
      document.getElementById('signup-form').classList.remove('active');
    };
    
    document.getElementById('signup-tab').onclick = function() {
      console.log('Signup tab clicked directly');
      document.getElementById('signup-tab').classList.add('active');
      document.getElementById('login-tab').classList.remove('active');
      document.getElementById('signup-form').classList.add('active');
      document.getElementById('login-form').classList.remove('active');
    };
  </script>
</body>
</html> 